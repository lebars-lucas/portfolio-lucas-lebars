---
// Page Loader Component
---

<!-- Page Loader moderne avec glissage vertical -->
<div id="pageLoader" class="fixed inset-0 z-[9999] pointer-events-none">
    <!-- Overlay: caché en bas, glisse pour entrer, repart par le haut -->
    <div
      id="loaderOverlay"
          class="absolute inset-0 bg-gradient-to-br from-forest-dark via-forest-deep to-forest-dark
              opacity-0 translate-y-full transition-all duration-700 ease-out"
    >
        <div class="absolute inset-0 flex items-center justify-center">
            <div class="text-center transform perspective-1000">
                <!-- Logo animé avec effet 3D -->
                <div class="mb-12 animate-[float_2s_ease-in-out_infinite] transform-gpu" style="transform-style: preserve-3d;">
                    <img src="/logo.svg" alt="Logo" class="w-32 h-20 mx-auto opacity-90" />
                </div>
                
                <!-- Barre de progression subtile -->
                <div class="relative w-[200px] mx-auto">
                    <div class="h-1 rounded-full overflow-hidden bg-white/10">
                        <div class="h-full w-1/3 bg-mint-light/70 animate-[loaderSlide_1.6s_ease-in-out_infinite]"></div>
                    </div>
                </div>
                
                <!-- Texte de chargement -->
                <p class="mt-8 text-mint-light font-medium text-xs tracking-[0.3em] uppercase opacity-70">Chargement</p>
            </div>
        </div>
    </div>
</div>

<script>
    const loader = document.getElementById('pageLoader');
    const overlay = document.getElementById('loaderOverlay');
    const hasVisited = sessionStorage.getItem('visited') === '1';

    function showLoader() {
        if (!loader || !overlay) return;
        loader.classList.remove('pointer-events-none');
        overlay.classList.remove('opacity-0', 'translate-y-full', '-translate-y-full');
        overlay.classList.add('opacity-100', 'translate-y-0');
    }

    function hideLoader() {
        if (!loader || !overlay) return;
        setTimeout(() => {
            overlay.classList.remove('translate-y-0');
            overlay.classList.add('-translate-y-full');
            setTimeout(() => {
                overlay.classList.remove('opacity-100', '-translate-y-full');
                overlay.classList.add('opacity-0', 'translate-y-full');
                loader.classList.add('pointer-events-none');
                sessionStorage.setItem('visited', '1');
            }, 700);
        }, 150);
    }

    // First visit only: show loader until all assets (incl. hero image) are ready
    if (!hasVisited) {
        // Show as soon as possible
        document.addEventListener('DOMContentLoaded', showLoader);
        window.addEventListener('load', hideLoader, { once: true });
    }

    // Lazy reveal for sections below the first hero
    document.addEventListener('DOMContentLoaded', () => {
        const sections = Array.from(document.querySelectorAll('section')) as HTMLElement[];
        if (sections.length <= 1) return;

        // Skip the first section (hero). Defer reveal of the rest.
        const toDefer = sections.slice(1);
        toDefer.forEach((el) => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(16px)';
            el.style.transition = 'opacity 500ms ease, transform 500ms ease';
        });

        const io = new IntersectionObserver((entries) => {
            for (const entry of entries) {
                if (entry.isIntersecting) {
                    const el = entry.target as HTMLElement;
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                    io.unobserve(el);
                }
            }
        }, { threshold: 0.1, rootMargin: '0px 0px -80px 0px' });

        toDefer.forEach((el) => io.observe(el));
    });
</script>

<style>
    @keyframes float {
        0%, 100% { 
            transform: translateY(0px) translateZ(0);
        }
        50% { 
            transform: translateY(-10px) translateZ(20px);
        }
    }

    @keyframes loaderSlide {
        0% { transform: translateX(-120%); }
        50% { transform: translateX(30%); }
        100% { transform: translateX(120%); }
    }

    .perspective-1000 {
        perspective: 1000px;
    }
</style>
